<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html lang="en-us">  <head>    <meta content="text/html; charset=utf-8" http-equiv="content-type">    <title>AFCDTech - Sparen's Danmakufu ph3 Tutorials - Unit 1 Lesson 8</title>    <link rel="stylesheet" type="text/css" href="../blah.css">    <meta content="Sparen's Danmakufu ph3 Tutorials Unit 1 Lesson 8 - Introduction to Shotsheets and Bullet Properties. A guide to understanding what is in a shotsheet, as well as the properties of bullets."      name="description">    <meta content="BlueGriffon wysiwyg editor" name="generator">
    <meta name="keywords" content="Sparen, Touhou, Danmakufu, ph3, Tutorial, Script, Danmaku, Bullet, Shot, Shotsheet, Property">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-58194930-1', 'auto');
    ga('send', 'pageview');
  </script>  </head>  <body id="mhome">    <div class="yui-t1" id="top">      <center><a href="http://sparen.github.io"><img alt="&quot;Site Logo&quot;" src="../images/logo.png"></a></center>      <br>      <div id="menubar">
        <ul>
          <li><a class="mhome" href="http://sparen.github.io" title="AFCDTech">Return to Home</a></li>
          <li><a class="mph3tutorials" href="./ph3tutorials.html" title="Sparen's Danmakufu ph3 Tutorials">ph3 Tutorial Index</a></li>
          <li><a class="mdnhwiki" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Main_Page">Danmakufu Wiki</a></li>
          <li><a class="mph3functionlist" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Functions_(ph3)">Ph3 Function List</a></li>
        </ul>
      </div>      <div id="bd">        <div id="yui-main">
          <div class="tutnavbar">
	    <ul>
	      <li><a href="./ph3u1l7.html" title="Sparen's Danmakufu ph3 Tutorials - Attack Flow and Our First Spellcard">Unit 1 Lesson 7</a></li>
	      <li>Navigation Bar</li>
	      <li>---</li>
	    </ul>
          </div>          <div class="yui-b">            <div style="width: 850px;" class="yui-g">              <h1 style="color:orange">Sparen's Danmakufu ph3 Tutorials Lesson 8 - Introduction to Shotsheets and Bullet Properties</h1>              <p>The video for this lesson is Infinite Ultima Wave's Christmas Letty script, one of the scripts I remember very fondly. It's quite good and despite all the red and yellow bullets, the bullet graphics chosen seem to fit Letty very well.</p>
	      <!--Embedded video below. Make sure to format the link correctly-->
	      <embed width="420" height="315"
		src="https://www.youtube.com/v/mF1NHOKhUoc">
	      <div style="width: 450px;" class="tutorialnav">
                <h2 style="color:aqua">Table of Contents</h2>
                <ul>
	          <li><a href="#sub1">Part 1: What will be Covered in this Lesson?</a></li>
	          <li><a href="#sub2">Part 2: What are Shotsheets and Shot Constant Sheets?</a></li>
	          <li><a href="#sub3">Part 3: What are the Properties of a Shot in a Shotsheet?</a></li>
	          <li><a href="#sub4">Part 4: What are the Properties of a Bullet? (ObjMove)</a></li>
	          <li><a href="#sub5">Part 5: How Do I Control a Bullet?</a></li>
	          <li><a href="#sub6">Part 6: What are the Properties of a Bullet? (ObjShot, ObjRender)</a></li>
	          <li><a href="#sub7">Part 7: What is the Difference Between ObjMove and ObjRender?</a></li>
	          <li><a href="#quiz1">Quiz: Bullet Properties</a></li>
	        </ul>
	      </div>              <h2 style="color:yellow" id="sub1">Part 1: What will be Covered in this Lesson?</h2>
	      <p>With such an ambiguous lesson title, you are probably wondering what I will be covering in this lesson. Put simply, I will introduce shotsheets as well as blend types, and will be explaining in detail the properties of bullets, including many of the ObjMove and ObjRender functions for bullets.</p>
	      <p>Although seemingly disjoint from the rest of the tutorials, I will be providing basic information on graphics in Danmakufu, and will also explain how I (and quite a few other) danmakufu scripters choose to load our shotsheets.</p>
              <h2 style="color:yellow" id="sub2">Part 2: What are Shotsheets and Shot Constant Sheets?</h2>
	      <p>By now, you should be familiar with the presence of <code>#include"script/default_system/Default_ShotConst.txt"</code> at the top of our Single scripts. If you remove this while firing shots in the script, you will get errors stating that some final constant in all caps has not been defined. Here I will provide a brief explanation for how this works, as well as shotsheets themselves.</p>
	      <p>In Touhou Danmakufu 0.12m, there were these things called 'shot replace' images that would override the default shotsheets, or you could use your own shotsheet. However, ph3 came along, and shot replace images are now outdated and there is no reason to use them. If you do in fact do a shot replace by replacing the image in the default system, that's perfectly fine - you just can't force someone else to do the same because you are overriding the defaults. And in fact, there is no need to because shotsheets in ph3 are significantly better than in 0.12m and should be used regardless.</p>
	      <p>First we will observe the Default_ShotConst.txt file in the default system, which is a shot constant file we have included. An include basically takes the contents of the included file and spills them into the script calling #include,  specifically at the place where the #include was. If we look inside this file, it states a path to Default_ShotData.txt and then loads the enemy shot data using <code>LoadEnemyShotData()</code>. This is how to load a shotsheet in a script. After this, a large number of final constants is declared, each referring to a number. So, what are those numbers? Well, we will discuss them in the next part when we discuss shot graphic IDs.</p>
	      <p>At this point, I would like to state something in regards to my scripts and those of some others who do not use a shot constant sheet. I personally remove the include statement to the shot constant file in a script. Why? I instead load the shotsheet (remember LoadEnemyShotData?), and then use the individual IDs. There is little to no benefit to doing this - it is a matter of style. However, most shot constant sheets do not account for every bullet ID, and those using shot constant sheets may never use certain bullet graphics because no final constant exists for those particular bullet ids. You can still refer to the bullets by number as well as by their final constant names, but most scripters do not mix and match final constants and numbers for shot graphics, instead sticking to one or the other. It's up to you whether to keep the shot constant sheet or not - the benefit is that if you change shotsheets while a script is under development, it is possible that the constant names will be the same and you will not have to change any of the graphic parameters in your script to change the graphic ids to the ones in the new shotsheet.</p>
	      <p>The file we will now observe is Default_ShotData.txt in the default system. Inside this file is something that looks absolutely obscure. What is going on here? No semicolons? Huh? This is a shotsheet. To begin a shotsheet, <code>#UserShotData</code> is used, and shot_image points to the path of the image file containing the bullet graphics. <strong>shot_image is NOT a variable.</strong> delay_rect is the part of the image that contains the delay cloud for the bullet.</p>
	      <p>Of particular note are the four parameters for delay_rect. They are left, top, right, and bottom, and refer to the pixels on the image file, and this left--top-right-bottom (LTRB) system is followed throughout all of Danmakufu. The numbers form a rectangle around the graphic, and 0 refers to the left or top of the image for x values (left, right) and y values (top, bottom) respectively. Please keep in mind that for top and right, the pixels that will be taken include one pixel to the top and right of the pixels represented by the numbers. It's annoying, but deal with it. Later on, when discussing ADD blending, I will briefly talk about white line syndrome, which is an unwanted side effect of this. !!!FACT CHECKERS PLEASE MAKE SURE THAT I GOT THIS RIGHT!!!</p>
	      <p>Now we will discuss the properties that can be assigned to shots in a shotsheet.</p>
              <h2 style="color:yellow" id="sub3">Part 3: What are the Properties of a Shot in a Shotsheet?</h2>
	      <p>Inside ShotData{} are a number of properties that can be assigned to shots. Of particular note are id, rect, and delay_color, which are required for proper functioning of the shot</p>
	      <p>id is the number that distinguishes the bullet graphic. It is what is referenced by the graphic parameter of most shot creation functions, and is also referenced in the shot constant sheet. It should be unique for the bullet.</p>
	      <p>rect, like in the delay_rect, determines the location of the shot on the image referenced in shot_image and controls what the shot will look like.</p>
	      <p>Finally, delay_color is the color of the delay graphic, taken in (R, G, B) format.</p>
	      <p>Besides the three properties listed above, you can also use render, angular_velocity, fixed_angle, and collision. You can also have Animation Data for animated shots, although this will not be discussed in this tutorial.</p>
	      <p>If you want to make your own shotsheets, please see my <a target="_blank" href="http://dmf.shrinemaiden.org/wiki/Sparen's_0.12m_to_ph3_Transition_Guide#ShotSheets" title="Sparen's 0.12m to ph3 Transition Guide - Shotsheets (Danmakufu Wiki)">0.12m to ph3 Transition Guide</a>, where I have provided some more detailed information on shotsheets.</p>
	      <p>Now to discuss the other properties. Firstly, render. This sets the Blend Type. The default is <a target="_blank" href="https://en.wikipedia.org/wiki/Alpha_compositing" title="Alpha Blending on Wikipedia">ALPHA</a>, which renders the graphic as-is, including transparency from the Alpha channel. You can also do <a target="_blank" href="https://en.wikipedia.org/wiki/Blend_modes#Addition" title="Add Blending on Wikipedia">ADD and ADD_ARGB</a>, which makes the bullet shiny. ADD requires a black background to make things shiny - otherwise it looks hideous. ADD_ARGB is based on the Alpha channel instead, and makes partially transparent bullets shiny. You can also use Subtractive and Multiplicative blends with SUBTRACT and MULTIPLY, but these are not usually used. Most of the time, you will use a function that will be discussed later, <code>ObjRender_SetBlendType()</code>, to change the render type of the graphic, and shotsheets therefore tend to contain only ALPHA and either ADD or ADD_ARGB shots. If render is not filled out, it defaults to ALPHA.</p>
	      <p>Next is angular_velocity. This controls the rotation of the bullet graphic. Default is 0, for no rotation.</p>
	      <p>Next is fixed_angle, which takes a boolean. True means that the bullet will always take the shape in the shotsheet and will never rotate. Default is false.</p>
	      <p>Finally, we have collision, which is the hitbox. By default, the hitbox is a percentage of the bullet graphic (in a circle), but by setting a value to collision (in pixels), you can specify a different radius for the hitbox, which originates from the center of the LTRB rectangle.</p>
	      <p>With that out of the way, let's begin our discussion on actual shots and their properties.</p>
              <h2 style="color:yellow" id="sub4">Part 4: What are the Properties of a Bullet? (ObjMove)</h2>
	      <p>Touhou Danmakufu ph3, unlike its predecessor 0.12m, is an object oriented scripting language. You may have noticed a lot of ObjType functions, and this is in part due to the nature of ph3. While not a true object oriented language, it shares many of the characteristics of one, including inheritance. We will have a long and lengthy discussion about this later on in this tutorial, but for now, I will try to make it as simple as possible.</p>
	      <p>Earlier we discussed the properties of the bullet graphic. Now we will discuss the properties of the bullet itself. Remember <code>CreateShotA1()</code>? It had a number of arguments, such as its x and y location, its angle, speed, graphic, and delay time. These are properties of the bullet that are set when the object is created (all of the ones perviously mentioned default to 0). Additionally, with <code>CreateShotA2()</code>, there is also acceleration and maximum/minimum speed.</p>
	      <p>Let's say that you want to create a shot starting at the boss that accelerates at the player from a speed of 3 pix/frames to 6 pix/frames. To do this, you would do the following:</p>
              <pre class="prettyprint"><code>CreateShotA2(ObjMove_GetX(objBoss), ObjMove_GetY(objBoss), 3, GetAngleToPlayer(objBoss), 0.05, 6, 5, 0);</code></pre>
	      <p>To best explain acceleration and maximum/minimum speed, it is important to note that without a max/min speed set prior, acceleration will not occur at all. When creating shots that take acceleration and min/max speed as parameters, this is not a problem, but it may be a problem later on. Additionally, the min/max speed is a minimum or a maximum depending on the initial speed, as well as the direction of the acceleration (whether it is positive or negative). If you have a starting speed of 5 and a min/max of 0, and your acceleration is negative, the bullet will start at a speed of 5 and decrease to 0, which is normal behavior - Danmakufu treats the min/max speed as a minimum. However, if the acceleration is positive, the bullet will not move at all and will have a speed of 0 to begin with. Take note of this, because Danmakufu is treating the min/max speed as a maximum. !!!FACT CHECK THIS PLEASE!!!</p>
	      <p>Besides <code>CreateShotA1()</code> and <code>CreateShotA2()</code>, there are also <code>CreateShotB1()</code> and <code>CreateShotB2</code>, which use x and y velocities rather than angle and speed. If you want gravity bullets, you may end up using these. Do be aware, however - you cannot apply any angle/speed changing functions to these and vice versa.</p>
	      <p>Now it is time to take a look at the <a target="_blank" href="http://dmf.shrinemaiden.org/wiki/Move_Object_Functions" title="Move Object Functions on the Danmakufu Wiki">Move Object Functions</a>.</p>
	      <p>Using ObjMove_SetXXX(), you can set the x, y, position (which is both x and y at once), speed, angle, acceleration, and max/min speed. You can also use the movement functions we used for the boss, as well as set angular velocity.</p>
	      <p>Angular velocity changes the angle of the bullet. The angle is incremented by the amount specified in the function every frame. However, how do we use <code>ObjMove_SetAngularVelocity()</code>? Or any of the AddPattern functions, which we will soon discuss?</p>
              <h2 style="color:yellow" id="sub5">Part 5: How Do I Control a Bullet?</h2>
	      <p>Bullet control in ph3 is significantly easier than in 0.12m. You don't need to create an object bullet, per se. Instead, you can do this!</p>
              <pre class="prettyprint"><code>let obj = CreateShotA1(ObjMove_GetX(objBoss), ObjMove_GetY(objBoss), 2, GetAngleToPlayer(objBoss), 5, 10);
ObjMove_SetAngularVelocity(obj, 0.1);
BulletCommands(obj);

//...

task BulletCommands(obj){
    wait(60);
    ObjMove_SetAngularVelocity(obj, 0);
}</code></pre>
	      <p>The portion before the <code>//...</code> is how to obtain the <b>Object ID</b> of a bullet, and then perform a function with that ID as an input parameter. After this, I call <code>BulletComamnds(obj)</code>, a task that I have created that will reset the angular velocity of the bullet to 0 after 60 frames. This is a powerful tool that, when used in conjunction with the AddPattern functions, can allow you to do all kinds of things with bullets, giving you immense control over what a bullet does. For example, I oftentimes have BulletCommands change the angular velocity and speed of the bullet, with while loops and wait times to denote when to actually begin execution. For example:</p>
              <pre class="prettyprint"><code>while(ObjMove_GetSpeed(obj)>0){yield;}
wait(30);
let angleT = rand(0,360);
loop(12){
    CreateShotA2(ObjMove_GetX(obj), ObjMove_GetY(obj), 0, angleT, 3, 0);
    angleT+=360/12;
}
Obj_Delete(obj);</code></pre>
	      <p>The above code waits for the bullet to have a speed of 0 (assume that it was accelerating in the negative direction beforehand), then waits 30 frames before spawning a ring of bullets at the bullet's location and deleting the bullet, giving the appearance of the bullet having exploded into other bullets.</p>
	      <p>Yes, this is very powerful. But with ObjMove_AddPattern, you can do so much more!</p>
	      <p>There are 7 ObjMove_AddPattern functions - 4 for angle/speed bullets and 3 for xspeed/yspeed bullets. Remember that you cannot use angle/speed functions on xspeed/yspeed bullets, and vice versa. Remember when I had that <code>wait(30);</code> in the code above? Well, the 'frame' argument does the same thing, except that the function presets the behavior of the bullet. When the allotted frames have passed, the bullet's properties will change to match those assigned in ObjMove_AddPattern when the function was called. In other words, if you set angle to be <code>GetAngleToPlayer(objBoss)</code> in ObjMove_AddPattern, the angle when the frames have passed will be that angle, not the current angle to the player. Alternatively, you could use the BulletCommands method, where you have the actual angle to the player. However, firing at where the player used to be also has its uses, so keep that in mind - ObjMove_AddPattern is a powerful and useful tool. If you do not want to change one of the options, use NO_CHANGE for the value - this is a final constant that will tell Danmakufu to not change anything.</p>
	      <p>However, do be aware that ObjMove_AddPattern has the tendency to do weird and unexpected things that you don't expect, especially in regards to the acceleration and max/min speeds. Additionally, be warned that if there is no acceleration and there is angular velocity, the bullet will form a circle and return to its spawning location. This can cheapshot players, break patterns, or be an amazing tool for beautiful patterns that require unique methods of dodging.</p>
              <h2 style="color:yellow" id="sub6">Part 6: What are the Properties of a Bullet? (ObjShot, ObjRender)</h2>
	      <p>Of course, ObjMove commands are not the only functions that can be used on bullets. Shot objects not only inherit all move and render functions - they have functions of their own.</p>
	      <p>Of these, there are a two that really stand out: <code>ObjShot_SetAutoDelete(obj)</code> and <code>ObjShot_SetSpellResist(obj)</code></p>
	      <p>The former, <code>ObjRender_SetAutoDelete(obj)</code>, controls auto-deletion of a bullet when the bullet goes offscreen. The latter, <code>ObjShot_SetSpellResist(obj)</code>, controls whether or not a shot will be deleted when the player bombs and/or when the player dies. By using these two functions, it is possible to control when a bullet will be deleted, etc. Very useful.</p>
	      <p>Something to note: not all of the functions under ObjShot can be used by enemy bullets - these functions are sometimes meant for use only by player shots, such as <code>ObjShot_SetPenetration(obj)</code>. Be aware of this - all damage, penetration, erase shot, spell factor, etc. functions are only for player shots.</p>
	      <p>Now I will discuss ObjRender functions.</p>
	      <p>--UNDER CONSTRUCTION BELOW THIS LINE--</p>

              <pre class="prettyprint"><code>//code here</code></pre>
              <h2 style="color:yellow" id="quiz1">Quiz: </h2>
	        <!--Quiz start.-->
		<br>
		<p>1) How long does it take for a bullet traveling at speed 4 (pixels/second) to travel from the left side of the default playing field to the right side (same y coordinate)?</p>
                <form method="POST" onSubmit="return checkAnswerGENERIC(this, 'A');">
                <input type="RADIO" value="A" name="cc">
                A. 96 frames<br>
                <input type="RADIO" value="B" name="cc">
                B. 160 frames<br>
                <input type="RADIO" value="C" name="cc">
                C. 112 frames<br>
                <input type="SUBMIT" value="Submit">
                </form>
		<br>
		<p>2) Minoriko wants her boss to move to the player's position every 180 frames. Which functions should she use?</p>
                <form method="POST" onSubmit="return checkAnswerA1(this, 'C');">
                <input type="RADIO" value="A" name="cc">
                A. <code>ObjMove_SetPosition()</code><br>
                <input type="RADIO" value="B" name="cc">
                B. <code>ObjMove_SetDestAtSpeed()</code><br>
                <input type="RADIO" value="C" name="cc">
                C. <code>ObjMove_SetDestAtFrame()</code><br>
                <input type="RADIO" value="D" name="cc">
                D. <code>ObjMove_SetDestAtWeight()</code><br>
                <input type="SUBMIT" value="Submit">
                </form>
              <br>            </div>          </div>
          <div class="tutnavbar">
	    <ul>
	      <li><a href="./ph3u1l7.html" title="Sparen's Danmakufu ph3 Tutorials - Attack Flow and Our First Spellcard">Unit 1 Lesson 7</a></li>
	      <li>Navigation Bar</li>
	      <li>---</li>
	    </ul>
	    <br>
          </div>        </div>      </div>      <div id="ft">
        <p style="text-align: center;">Last Update to Page: Feb 3, 2015</p>        <p style="text-align: center;"><a href="#top">Top</a></p>        <p style="text-align: center;">Copyright © 2014-2015 by Andrew Fan</p>        <p style="text-align: center;"><span style="font-weight: bold;">Other            Sites/Affiliates</span></p>        <div style="text-align: center;"><a target="_blank" href="http://www.winehq.org"><img              alt="&quot;Wine HQ&quot;"              src="../images/afflogowinehq.png"></a>          <a target="_blank" href="http://www.shrinemaiden.org/forum/index.php"><img              alt="&quot;Maidens of the Kaleidoscope&quot;"              src="../images/afflogomotk.png"></a>          <a target="_blank" href="http://www.bulletforge.org"><img alt="&quot;Bulletforge&quot;"              src="../images/afflogobulletforge.png"></a>          <a target="_blank" href="http://moriyashrine.weebly.com/index.html"><img              alt="&quot;Moriya Shrine&quot;"              src="../images/afflogomoriyashrine.png"></a>        </div>
        <div style="text-align: center;"><br>
          <p><b>ADVERTISEMENTS</b></p>
          <p>Hey scripters! Want me to feature your script/project/blog/website/Youtube video down here?</p>
          <p>Read <a href="../advertisements.html">this page</a> for more information.</p><br>
        </div>      </div>    </div>
    <script language="JavaScript" type="text/javascript" src="javascript/GenericQuiz.js"></script>
    <script language="JavaScript" type="text/javascript" src="javascript/QReviewP.js"></script>
    <script language="JavaScript" type="text/javascript" src="javascript/U1L7Quiz1.js"></script>
    <link href="customhighlighter/desert.css" type="text/css" rel="stylesheet" />
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=c"></script>  </body></html>