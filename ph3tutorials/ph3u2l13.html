<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html lang="en-us">  <head>    <meta content="text/html; charset=utf-8" http-equiv="content-type">    <title>AFCDTech - Sparen's Danmakufu ph3 Tutorials - Lesson 13</title>    <link rel="stylesheet" type="text/css" href="../blah.css">    <meta content="Sparen's Danmakufu ph3 Tutorials Lesson 13 - Introduction to 2D Sprites. A guide to understand and using 2D Sprites in Touhou Danmakufu ph3."      name="description">
    <meta name="keywords" content="Sparen, Touhou, Danmakufu, ph3, Tutorial, Script, Danmaku, Plural, Boss, Sprite, Primitive">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-58194930-1', 'auto');
    ga('send', 'pageview');
  </script>  </head>  <body id="mhome">    <div class="yui-t1" id="top">      <center><a href="http://sparen.github.io"><img alt="&quot;Site Logo&quot;" src="../images/logo.png"></a></center>      <br>      <div id="menubar">
        <ul>
          <li><a class="mhome" href="http://sparen.github.io" title="AFCDTech">Return to Home</a></li>
          <li><a class="mph3tutorials" href="./ph3tutorials.html" title="Sparen's Danmakufu ph3 Tutorials">ph3 Tutorial Index</a></li>
          <li><a class="mdnhwiki" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Main_Page">Danmakufu Wiki</a></li>
          <li><a class="mph3functionlist" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Functions_(ph3)">Ph3 Function List</a></li>
        </ul>
      </div>      <div id="bd">        <div id="yui-main">
          <div class="tutnavbar">
	    <ul>
	      <li><a href="./ph3u2l12.html" title="Sparen's Danmakufu ph3 Tutorials - Creating and Utilizing Plural Scripts">Unit 2 Lesson 12</a></li>
	      <li>Navigation Bar</li>
	      <li>---</li>
	    </ul>
          </div>          <div class="yui-b">            <div style="width: 850px;" class="yui-g">	      <h1 style="color:orange">Sparen's Danmakufu ph3 Tutorials Lesson 13 - Introduction to 2D Sprites</h1>	      <p>The video for this lesson is Koishi Adventure by Darkness1, chosen due to its usage of images and the like.</p>
	      <!--Embedded video below. Make sure to format the link correctly-->
	      <embed width="420" height="315"
		src="https://www.youtube.com/v/NpeQY_YR0o0">
	      <div style="width: 600px;" class="tutorialnav">
	        <h2 style="color:aqua">Table of Contents</h2>
	        <ul>
	          <li><a href="#sub1">Part 1: What will be Covered in this Lesson?</a></li>
	          <li><a href="#sub2">Part 2: What are Primitive Types and 2D Sprites?</a></li>
	          <li><a href="#sub3">Part 3: What Functions Do I Use with 2D Sprites?</a></li>
	          <li><a href="#sub4">Part 4: How Do I Display an Image?</a></li>
	          <li><a href="#sub5">Part 5: How Do I Animate a Boss?</a></li>
	          <li><a href="#quiz1">Quiz: 2D Sprites</a></li>
	          <li><a href="#sub6">Part 6: What are Render Priorities?</a></li>
	          <li><a href="#subf">Sources and External Resources</a></li>
	        </ul>
	      </div>	      <h2 style="color:yellow" id="sub1">Part 1: What will be Covered in this Lesson?</h2>
	      <p>We've finally arrived at the lesson you've probably all been waiting for - 2D Sprites. In this lesson, I will cover creation of 2D Sprites, and will show a basic boss animation, among other things. So? Let's get started!</p>
	      <h2 style="color:yellow" id="sub2">Part 2: What are Primitive Types and 2D Sprites?</h2>
	      <p>Everything in Danmakufu (and all software in general) is rendered as a primitive with a vertex shader. Primitives are, simply put, complicated, so we will go over more complicated primitive types in a later lesson. The good thing is that you are not required to know all of the nitty gritty details about primitives in Danmakufu ph3 to display simple graphics, as ph3 introduces the 2D Sprite and 3D Sprite.</p>
	      <p>Let's say that you have an image (preferably whose dimensions are powers of two so that DirectX will not scale them incorrectly). It has Cirno on it. We want to display Cirno on the screen. Therefore, we will render Cirno as a 2D Sprite. Enemy Objects by default have a render component that is a 2D Sprite, so you can use 2D Sprite functions on an enemy object. But for all other cases, you will create a 2D Sprite using the following: <code>ObjPrim_Create(OBJ_SPRITE_2D);</code>. This will create a 2D Sprite, which is a rectangle in 2D space (3D sprites are manipulated with different functions, and we will discuss them later when we cover background scripts). 2D Sprites are technically a primitive type, but for the most part, you will simply use ObjSprite2D and ObjRender functions on them.</p>
	      <h2 style="color:yellow" id="sub3">Part 3: What Functions Do I Use with 2D Sprites?</h2>
	      <p>As stated above, you will use ObjRender and ObjSprite2D functions on 2D Sprite Objects, as well as <code>ObjPrim_SetTexture()</code> and the render priority functions (which I will discuss later in the lesson) and Blend Type functions (which will be discussed in the next lesson). First, I'll discuss <code>ObjPrim_SetTexture()</code>.</p>
	      <p><code>ObjPrim_SetTexture()</code> is basically required for 2D Sprites, because it's the function you use when you tell Danmakufu which image to use. It takes two parameters, the object ID of the primitive object, and the path to the image. It is recommended that you save the path name as a variable and then pass the variable in as the second parameter, as it looks cleaner and helps save a little computation time if you use the same image file multiple times in the same task/script. After you've set the texture, you will need to tell Danmakufu how to render the image, and which part of the image you want rendered.</p>
	      <p>Primitives consist of vertices, which are basically points in space. By connecting and rendering them in a certain way, you can create specific shapes and the like. With 2D Sprites, you basically have four vertices, and the UVT and XY mappings are simplified from clunky functions into three very simple functions - <code>ObjSprite2D_SetSourceRect()</code>, <code>ObjSprite2D_SetDestRect()</code>, and <code>ObjSprite2D_SetDestCenter()</code>.</p>
	      <p><code>ObjSprite2D_SetSourceRect()</code> is the function you use to tell Danmakufu which part of the image sheet you want to render. It takes five parameters - the object to assign the rects to, and the four bounds - Left, Top, Right, and Bottom.</p>
	      <p>As a refresher, consider your image file, with (0,0) being the top left corner. In a graphical editor, use the rectangular select tool and drag from the top left (0,0) to another point. The coordinates of the destination and the origin designate the rectangle. The four bounds of this rectangle would be (0, 0, x, y), where x is the x coordinate of the cursor and where y is the y coordinate of the cursor.</p>
	      <p>Note that the second (top) and third (right) arguments should be one greater than displayed when you are looking at the rects in a graphical editor. In other words, if you want to use a 64x64 sprite whose bounds are (0, 0, 64, 64), you should use (0, 1, 63, 64) in the source rect function. Otherwise you may get wrapping weirdness and undesirable side effects. <b><span style="color:magenta">!!!FACT CHECK NEEDED!!!</span></b></p>
	      <p>The source of this weirdness is because of how SourceRect works - if you exceed the boundaries of an image, it will wrap. Basically, think of seamless textures that you can tile together.</p>
	      <p>Now, you have two options for the destination rects. You can manually set them using <code>ObjSprite2D_SetDestRect()</code>, or you can have it automatically centered, using <code>ObjSprite2D_SetDestCenter()</code>.</p>
	      <p>As for what DestCenter does, say you have a 64x96 sprite (e.g. Seiran in LoLK). Using <code>ObjSprite2D_SetDestCenter(objBoss)</code> is equivalent to using <code>ObjSprite2D_SetDestRect(objBoss, -32, -48, 32, 48);</code></p>
	      <div class="tut_checkpoint">CHECKPOINT: How do <code>ObjSprite2D_SetSourceRect()</code> and <code>ObjSprite2D_SetDestRect()</code> work? How can you change the scale of an image by altering the Dest Rect?</div>
	      <h2 style="color:yellow" id="sub4">Part 4: How Do I Display an Image?</h2>
	      <p>It is now time to display images! For the purposes of this tutorial, I will provide a spritesheet for you. Link <a target="_blank" href="http://www.mediafire.com/download/tnj153hbh2iebyq/th125e.rar">here</a> (Double Spoiler graphics). The source of this rip is from <a target="_blank" href="https://www.shrinemaiden.org/forum/index.php/topic,197.0.html">Drake's rips</a> on Maidens of the Kaleidoscope - he has a comprehensive list of images ripped from the official Touhou games. For this lesson, I will be using Sanae's sprites from Double Spoiler. Sanae is en28 in the enm folder.</p>
	      <p>We will begin by examining cdbg05a, the static component of her spellcard background. Our mission in this part is to take this image and display it using Danmakufu. Since we have not yet covered Background scripts, simply make a task called <code>RenderBG</code> in a single and call it in @Initialize.</p>
	      <p>Now, the components of given task. First, we will declare a variable obj and will assign the returned object ID of <code>ObjPrim_Create(OBJ_SPRITE_2D)</code>. This is the object we will be manipulating in this task.</p>
	      <p>The next step is <code>ObjPrim_SetTexture()</code>. I am going to assume that you are keeping the image file in the same directory as the single file - in practice this is poor design as it gets very hard to find things - I suggest keeping all of your images in a single folder separate from your code.</p>
	      <p>There are two ways you can assign the texture to the object. You can either plug the path in directly, or as stated before, create a variable to contain the path. Let's use the variable, as it will make the code cleaner.</p>
	      <pre class="prettyprint"><code>    task RenderBG{
	let obj = ObjPrim_Create(OBJ_SPRITE_2D);
	let imgpath = GetCurrentScriptDirectory~"./cdbg05a.png";
	ObjPrim_SetTexture(obj, imgpath);
    }</code></pre>
	      <p>Now we need to assign the rects. Let's open the image.</p>
	      <p>The first thing you will notice is that there is a lot of transparent space. The part we want is 384x448, the size of the playing field. But the texture is 512x512. This is because in Danmakufu, a DirectX9 feature is used that scales the dimensions of all textures to powers of two, as it speeds up the texture loading process. However, if you use textures whose dimensions are not powers of two the final result will be blurred due to the scaling of the image during loading. It is best practice to counteract this by making all your textures with dimensions of powers of two regardless of whether that is the actual size of the graphic.</p>
	      <p>Anyways, we have our rects - the part we want is from (0,0) to (384,448). Let's put them in.</p>
	      <pre class="prettyprint"><code>    task RenderBG{
	let obj = ObjPrim_Create(OBJ_SPRITE_2D);
	let imgpath = GetCurrentScriptDirectory~"./cdbg05a.png";
	ObjPrim_SetTexture(obj, imgpath);
	ObjSprite2D_SetSourceRect(obj, 0, 1, 383, 448);
	ObjSprite2D_SetDestCenter(obj);
	ObjRender_SetPosition(obj, 384/2, 448/2); //move it to the center of the screen
    }</code></pre>
	      <p>And there we have it! In regards to positioning, passing a 0 into SetDestRect will basically place that  side of the image at the location of the object. In other words, if you have a 64x96 image, its position is (384/2, 448/2), and its DestRect is (0, 0, 64, 96), the left side of the image will be on the horizontal center axis, the top side will be on the vertical center axis, and the other two sides will be offset from given axes by 64 and 96 pixels, respectively. SetDestRect can be used to scale the graphic, although <code>ObjRender_SetScaleXYZ()</code> is far more flexible at doing this.</p>
	      <div class="tut_exercise">EXERCISE: Find a seamless texture online. Experiment with Source and Dest rects. Tile the graphic with SourceRect and scale it with DestRect. Get a feel for how you can manipulate the images.</div>
	      <h2 style="color:yellow" id="sub5">Part 5: How Do I Animate a Boss?</h2>
	      <p></p>
	      <p></p>
	      <pre class="prettyprint"><code></code></pre>
	      <p></p>
	      <pre class="prettyprint"><code></code></pre>
	      <p>UNDER CONSTRUCTION BELOW THIS LINE</p>
	      <h2 style="color:yellow" id="quiz1">Quiz: 2D Sprites</h2>
	        <!--Quiz start.-->
		<p>Use the following code for questions 1-3</p>
		<style>
	        .prettyprint ol.linenums > li { list-style-type: decimal; background-color: black;}
    		</style>
	      <pre class="prettyprint class=linenums"><code>#TouhouDanmakufu[Plural]
#ScriptVersion[3]
#Title["My First Boss Script"]
#Text[] 

@Event{
}

@Initialize{
    TPlural;
}

@MainLoop{
    //Question 1
}

task TPlural{
    let dir=GetCurrentScriptDirectory();
    //Question 2
    ObjEnemyBossScene_Add(obj,0,dir~"./Nonspell1.txt");
    ObjEnemyBossScene_LoadInThread(obj);
    //Question 3
    while(!Obj_IsDeleted(obj)){
        yield;
    }
    CloseScript(GetOwnScriptID());
}</code></pre>
		<p>1) What code should be added to line 14 to allow the task to work properly (assume Lines 19 and 22 are filled correctly)?</p>
	        <form method="POST" onSubmit="return checkAnswerP(this, 'A', 3);">
	        <input type="RADIO" value="A" name="cc">
	        A. <code>yield;</code><br>
	        <input type="RADIO" value="B" name="cc">
	        B. Nothing should be added - the task will run.<br>
	        <input type="RADIO" value="C" name="cc">
	        C. <code>RaiseError(":3");</code><br>
	        <input type="SUBMIT" value="Submit">
	        </form>
		<br>
		<p>2) What code should be added to line 19 to correctly instantiate the Enemy Boss Scene Object?</p>
	        <form method="POST" onSubmit="return checkAnswerP(this, 'C', 3);">
	        <input type="RADIO" value="A" name="cc">
	        A. <code>let obj=ObjBossScene_Create();</code><br>
	        <input type="RADIO" value="B" name="cc">
	        B. <code>let obj=ObjEnemyBossScene_Create(SCENE_BOSS);</code><br>
	        <input type="RADIO" value="C" name="cc">
	        C. <code>let obj=ObjEnemyBossScene_Create();</code><br>
	        <input type="SUBMIT" value="Submit">
	        </form>
		<br>
		<p>3) What code should be added to line 22 to correctly run the Boss Scene?</p>
	        <form method="POST" onSubmit="return checkAnswerP(this, 'B', 4);">
	        <input type="RADIO" value="A" name="cc">
	        A. <code>ObjEnemyBossScene_Register(obj);</code><br>
	        <input type="RADIO" value="B" name="cc">
	        B. <code>ObjEnemyBossScene_Regist(obj);</code><br>
	        <input type="RADIO" value="C" name="cc">
	        C. <code>ObjEnemyBossScene_Run(obj);</code><br>
	        <input type="SUBMIT" value="Submit">
	        </form>
	      <h2 style="color:yellow" id="subf">Sources and External Resources</h2>
	      <p>N/A</p>
	      <br>            </div>          </div>
          <div class="tutnavbar">
	    <ul>
	      <li><a href="./ph3u2l12.html" title="Sparen's Danmakufu ph3 Tutorials - Creating and Utilizing Plural Scripts">Unit 2 Lesson 12</a></li>
	      <li>Navigation Bar</li>
	      <li>---</li>
	    </ul>
	    <br>
          </div>        </div>      </div>      <div id="ft">
        <p style="text-align: center;">Last Update to Page: May 27, 2015</p>        <p style="text-align: center;"><a href="#top">Top</a></p>        <p style="text-align: center;">Copyright © 2014-2015 by Andrew Fan</p>        <p style="text-align: center;"><span style="font-weight: bold;">Other            Sites/Affiliates</span></p>        <div style="text-align: center;"><a target="_blank" href="http://www.winehq.org"><img	      alt="&quot;Wine HQ&quot;"	      src="../images/afflogowinehq.png"></a>          <a target="_blank" href="http://www.shrinemaiden.org/forum/index.php"><img	      alt="&quot;Maidens of the Kaleidoscope&quot;"	      src="../images/afflogomotk.png"></a>          <a target="_blank" href="http://www.bulletforge.org"><img alt="&quot;Bulletforge&quot;"	      src="../images/afflogobulletforge.png"></a>          <a target="_blank" href="http://moriyashrine.weebly.com/index.html"><img	      alt="&quot;Moriya Shrine&quot;"	      src="../images/afflogomoriyashrine.png"></a>        </div>
        <div style="text-align: center;"><br>
          <p><b>ADVERTISEMENTS</b></p>
          <p>Hey scripters! Want me to feature your script/project/blog/website/Youtube video down here?</p>
          <p>Read <a href="../advertisements.html">this page</a> for more information.</p><br>
        </div>      </div>    </div>
    <script language="JavaScript" type="text/javascript" src="javascript/GenericQuiz.js"></script>
    <script language="JavaScript" type="text/javascript" src="javascript/QReviewP.js"></script>
    <script language="JavaScript" type="text/javascript" src="javascript/U1L10Quiz1.js"></script>
    <link href="customhighlighter/desert.css" type="text/css" rel="stylesheet" />
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=c"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>  </body></html>