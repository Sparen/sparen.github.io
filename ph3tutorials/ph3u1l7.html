<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html lang="en-us">  <head>    <meta content="text/html; charset=utf-8" http-equiv="content-type">    <title>AFCDTech - Sparen's Danmakufu ph3 Tutorials - Unit 1 Lesson 7</title>    <link rel="stylesheet" type="text/css" href="../blah.css">    <meta content="Andrew Fan's Code Dump: The Embodiment of Code and Hacks (AFCDTECH)"      name="description">    <meta content="BlueGriffon wysiwyg editor" name="generator">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-58194930-1', 'auto');
    ga('send', 'pageview');
  </script>  </head>  <body id="mhome">    <div class="yui-t1" id="top">      <center><a href="../index.html"><img alt="&quot;Site Logo&quot;" src="../images/logo.png"></a></center>      <br>      <div id="menubar">
        <ul>
          <li><a class="mhome" href="../index.html">Return to Home</a></li>
          <li><a class="mph3tutorials" href="./ph3tutorials.html">ph3 Tutorial Index</a></li>
          <li><a class="mdnhwiki" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Main_Page">Danmakufu Wiki</a></li>
          <li><a class="mph3functionlist" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Functions_(ph3)">Ph3 Function List</a></li>
        </ul>
      </div>      <div id="bd">        <div id="yui-main">          <div class="yui-b">            <div style="width: 850px;" class="yui-g">              <h1 style="color:orange">Lesson 7 - Attack Flow and Our First Spellcard</h1>              <p>The video for this lesson is Lunarethic's AllSpell Youmu! Since we're going to be talking about spells (though that's not the focus of the lesson), what better option than this? (And yes, I know that I'm showing some of the best scripts I have played for DNHArt. There will come a time when other scripters will be featured)</p>
	      <!--Embedded video below. Make sure to format the link correctly-->
	      <embed width="420" height="315"
		src="https://www.youtube.com/v/s6raKTIzfpM">
	      <div style="width: 450px;" class="tutorialnav">
                <h2 style="color:aqua">Table of Contents</h2>
                <ul>
	          <li><a href="#sub1">Part 1: How Do I Designate a Single as a Spellcard?</a></li>
	          <li><a href="#sub2">Part 2: What are the Movement Functions?</a></li>
	          <li><a href="#quiz1">Quiz: Frames, Speed, and yield;</a></li>
	        </ul>
	      </div>              <h2 style="color:yellow" id="sub1">Part 1: How Do I Designate a Single as a Spellcard?</h2>
	      <p>To begin, a note. I will not be involving the @MainLoop style from now on - I will show the task method and my own method, because the former is commonly used and because the latter is good for understanding alternate ways in which you can script Danmakufu.</p>
	      <p>So first, we will begin by starting off with our code from last time. We will now begin the transformation from a nonspell to a spell! We will also be adding an number of things that will greatly assist us.</p>
	      <p>First, the section with global variables. Currently, we only have <code>let objBoss;</code>. Right after that, we will want to add the following:</p>
                <pre><code>    let objScene=GetEnemyBossSceneObjectID();</code></pre>
	      <p>This will allow us to access the Enemy Boss Scene Object. We will not usually do anything with this object, but it should find a comfortable place in your global variable section and we will directly use it in all spellcards.</p>
	      <p>Now we will look at @Initialize. Please note that there is no default cutin function in ph3. I suggest using GTbot's or Helepolis's, which can be found on MotK or Bulletforge. Additionally, you can make your own, but we will need understanding of text objects and render objects before we can go into that.</p>
	      <p>The most important line we will add to @Initialize is <code>ObjEnemyBossScene_StartSpell(objScene);</code>. Add it before TFinalize. This code will tell Danmakufu that we are now starting a spellcard. Additionally, we will begin cleaning up @Initialize. I suggest taking all the boss drawing code (the imgRumia stuff) and placing it in a task TDrawLoop and calling that in @Initialize. This will allow us to animate the boss later on and will make @Initialize look cleaner. <b>Do not move the movement code into TDrawLoop.</b> While it is not detrimental, you may end up not being able to find the movement code if you end up looking for it.</p>
	      <p>Now we will move to @Event. Thankfully, we already have EV_REQUEST_SPELL_SCORE, which is the spellcard bonus! So we don't have to do anything here. However, I will cover the three events we have. As a refresher, EV_REQUEST_LIFE sets the boss's life, EV_REQUEST_TIMER sets the timeout counter (in seconds), and EV_REQUEST_SPELL_SCORE sets the spellcard bonus.</p>
	      <p>Finally, to complete the transformation into a spellcard, there is an optional but highly recommended procedure that will go in TFinalize. What is it, you ask? Well, adding the spellcard bonus!</p>
	      <p>Danmakufu does not do it automatically: you must manually add the spellcard bonus. I know, it's a pain. But it's not hard to implement. Right after the while loop in TFinalize, add the following:</p>
                <pre><code>	if(ObjEnemyBossScene_GetInfo(objScene, INFO_PLAYER_SHOOTDOWN_COUNT)
              +ObjEnemyBossScene_GetInfo(objScene, INFO_PLAYER_SPELL_COUNT) == 0){
	  AddScore(ObjEnemyBossScene_GetInfo(objScene,INFO_SPELL_SCORE));
	}</code></pre>
	      <p>Basically, this code will check if the spell was captured. If it was, it will add the spellcard bonus. And with that, we have our basic spell done! Now to add stuff to it!</p>
              <p>As a final note, it is also possible to <code>ObjEnemyBossScene_StartSpell(GetEnemyBossSceneObjectID)</code> instead of having a global variable to store the EnemyBossSceneObject's ID, but you will have to use the Get ID function multiple times in the spellcard bonus code.</p>
              <h2 style="color:yellow" id="sub2">Part 2: What are the Movement Functions?</h2>
	      <p>In our old script, all the boss did was sit there and shoot a bullet at the player every half second (30 frames). Now the boss will move!</p>
	      <p>For the tasking style, we will create a task called movement; and call it right before the while loop in  MainTask. And then we will do something that will make many people relieved: add a wait(120) before the while loop in MainTask. This will delay the task 120 frames before beginning to fire. The boss will be able to move into position, etc. For my style, set counter to -120 to start, and in the if statement controlling firing, add <code>&& count>=0</code>. As for movement, we can use the same movement task (I personally do this differently) as with the tasking style, which we will make below.</p>
	      <p>So, movement. For objects on which ObjMove functions apply, there are all kinds of ways to move the enemy. Documentation <a target="_blank" href="http://dmf.shrinemaiden.org/wiki/Move_Object_Functions">here</a>.</p>
	      <p>Firstly, we will not be using <code>ObjMove_SetX()</code>, <code>ObjMove_SetY()</code>, <code>ObjMove_SetPosition()</code>, <code>ObjMove_SetSpeed()</code>, or <code>ObjMove_SetAngle()</code>. Generally speaking, teleporting the boss halfway across the screen does not work well in playing, and using a speed/angle approach can be a royal pain to control. We will use these functions for positioning of things like bullets, but not for the boss. Instead, we will use the following: <code>ObjMove_SetDestAtSpeed()</code>, <code>ObjMove_SetDestAtFrame()</code>, and <code>ObjMove_SetDestAtWeight()</code>. You specify the object and the destination, and then specify either the speed to go at (constant for the entire journey), how many frames to take, or the weight and max speed. Personally, I never use <code>ObjMove_SetDestAtSpeed()</code> because it is hard to sync anything else with it. <code>ObjMove_SetDestAtFrame()</code> is the best for syncing firing with movement. <code>ObjMove_SetDestAtWeight()</code> looks the most natural, although it requires more experience to control. We will use <code>ObjMove_SetDestAtFrame()</code> in this tutorial.</p>
	      <p>In the task movement, we will now add a while loop just like the one in MainTask (It is also possible to put movement; inside the while loop of MainTask; and not include the while loop in movement;). And then, we will add <code>	  ObjMove_SetDestAtFrame(objBoss, rand(GetCenterX+90,GetCenterX-90), rand(GetCenterY-60,GetCenterY-120), 60);</code> inside, as well as a <code>wait(240);</code>. This will move the boss to a random point within the bounds set every 240 frames. Note that the movement works parallel to what called it - that is, the boss will start moving when the function is called, and will finish moving 60 frames later, leaving 180 frames before the boss begins moving again.</p>
	      <p>Our movement task now looks like this:</p>
              <pre><code>    task movement{
        while(ObjEnemy_GetInfo(objBoss,INFO_LIFE)>0){
            ObjMove_SetDestAtFrame(objBoss, rand(GetCenterX+90,GetCenterX-90), rand(GetCenterY-60,GetCenterY-120), 60);
            wait(240);
        }
    }</code></pre>
	      <p>Now that our boss is moving, it is time for a short quiz, after which we will learn to do things more complex that firing a single bullet at the player.</p>
              <h2 style="color:yellow" id="quiz1">Quiz: Frames, Speed, and yield;</h2>
	        <!--Quiz start.-->
		<br>
		<p>1) How long does it take for a bullet traveling at speed 4 (pixels/second) to travel from the left side of the default playing field to the right side (same y coordinate)?</p>
                <form method="POST" onSubmit="return checkAnswerGENERIC(this, 'A');">
                <input type="RADIO" value="A" name="cc">
                A. 96 frames<br>
                <input type="RADIO" value="B" name="cc">
                B. 160 frames<br>
                <input type="RADIO" value="C" name="cc">
                C. 112 frames<br>
                <input type="SUBMIT" value="Submit">
                </form>
		<br>
		<p>2) Minoriko wants her boss to move to the player's position every 180 frames. Which functions should she use?</p>
                <form method="POST" onSubmit="return checkAnswerA1(this, 'C');">
                <input type="RADIO" value="A" name="cc">
                A. <code>ObjMove_SetPosition()</code><br>
                <input type="RADIO" value="B" name="cc">
                B. <code>ObjMove_SetDestAtSpeed()</code><br>
                <input type="RADIO" value="C" name="cc">
                C. <code>ObjMove_SetDestAtFrame()</code><br>
                <input type="RADIO" value="D" name="cc">
                D. <code>ObjMove_SetDestAtWeight()</code><br>
                <input type="SUBMIT" value="Submit">
                </form>
		<br>
		<p>3) Shizuha wants to move the boss to a position every 45 frames, and she is syncing the spawning of bullets to this. Which function should she NOT use?</p>
                <form method="POST" onSubmit="return checkAnswerP(this, 'B', 2);">
                <input type="RADIO" value="A" name="cc">
                A. <code>ObjMove_SetPosition()</code><br>
                <input type="RADIO" value="B" name="cc">
                B. <code>ObjMove_SetDestAtSpeed()</code><br>
                <input type="RADIO" value="C" name="cc">
                C. <code>ObjMove_SetDestAtFrame()</code><br>
                <input type="SUBMIT" value="Submit">
                </form>
              <p>NOTE: Below is for reference when I write the tutorial. That way I can easily copy-paste the skeleton.</p>
              <h2 style="color:yellow" id="cp2">Checkpoint - Tasking</h2>
              <p>Tasking style</p>
              <pre><code>#TouhouDanmakufu[Single]
#ScriptVersion[3]
#Title["My First Danmakufu Script!"]
#Text["Code by Sparen[r]My First Bullet!"]
#BGM["./necrofantasia.ogg"]

#include"script/default_system/Default_ShotConst.txt"

let objBoss;

@Event{
	alternative(GetEventType())
	case(EV_REQUEST_LIFE){
		SetScriptResult(500);
        }
	case(EV_REQUEST_TIMER){
		SetScriptResult(60);
	}
	case(EV_REQUEST_SPELL_SCORE){
		SetScriptResult(1000000);
	}
}

@Initialize{
	objBoss = ObjEnemy_Create(OBJ_ENEMY_BOSS);
	ObjEnemy_Regist(objBoss);
	let imgExRumia = GetCurrentScriptDirectory ~ "ExRumia.png";
	ObjPrim_SetTexture(objBoss, imgExRumia);
	ObjSprite2D_SetSourceRect(objBoss, 64, 1, 127, 64);
	ObjSprite2D_SetDestCenter(objBoss);
        ObjMove_SetDestAtFrame(objBoss, GetCenterX, 60, 60);

        TFinalize;
	MainTask;
}

@MainLoop{
        ObjEnemy_SetIntersectionCircleToShot(objBoss, ObjMove_GetX(objBoss), ObjMove_GetY(objBoss), 32); 
        ObjEnemy_SetIntersectionCircleToPlayer(objBoss, ObjMove_GetX(objBoss), ObjMove_GetY(objBoss), 24);
        yield;
}

task MainTask{
    while(ObjEnemy_GetInfo(objBoss,INFO_LIFE)>0){
        let angleT = GetAngleToPlayer(objBoss);
        CreateShotA1(ObjMove_GetX(objBoss), ObjMove_GetY(objBoss), 2, angleT, DS_BALL_S_RED, 5);
        wait(30);
    }
}

task TFinalize {
        while(ObjEnemy_GetInfo(objBoss,INFO_LIFE)>0){yield;}
	Obj_Delete(objBoss);
	DeleteShotAll(TYPE_ALL,TYPE_IMMEDIATE);
	SetAutoDeleteObject(true);
	CloseScript(GetOwnScriptID());
	return;
}

function GetCenterX{
     return GetStgFrameWidth/2;
}
function GetCenterY{
     return GetStgFrameHeight/2;
}

function wait(n){
     loop(n){yield;}
}</code></pre>
              <h2 style="color:yellow" id="cp4">Checkpoint - Sparen</h2>
              <p>Sparen style</p>
              <pre><code>#TouhouDanmakufu[Single]
#ScriptVersion[3]
#Title["My First Danmakufu Script!"]
#Text["Code by Sparen[r]My First Bullet!"]
#BGM["./necrofantasia.ogg"]

#include"script/default_system/Default_ShotConst.txt"

let objBoss;
let count = 0;

@Event{
	alternative(GetEventType())
	case(EV_REQUEST_LIFE){
		SetScriptResult(500);
        }
	case(EV_REQUEST_TIMER){
		SetScriptResult(60);
	}
	case(EV_REQUEST_SPELL_SCORE){
		SetScriptResult(1000000);
	}
}

@Initialize{
	objBoss = ObjEnemy_Create(OBJ_ENEMY_BOSS);
	ObjEnemy_Regist(objBoss);
	let imgExRumia = GetCurrentScriptDirectory ~ "ExRumia.png";
	ObjPrim_SetTexture(objBoss, imgExRumia);
	ObjSprite2D_SetSourceRect(objBoss, 64, 1, 127, 64);
	ObjSprite2D_SetDestCenter(objBoss);
        ObjMove_SetDestAtFrame(objBoss, GetCenterX, 60, 60);

        TFinalize;
}

@MainLoop{
        ObjEnemy_SetIntersectionCircleToShot(objBoss, ObjMove_GetX(objBoss), ObjMove_GetY(objBoss), 32); 
        ObjEnemy_SetIntersectionCircleToPlayer(objBoss, ObjMove_GetX(objBoss), ObjMove_GetY(objBoss), 24);
        if(count%30==0){
            fire;
        }
        count++;
        yield;
}

task fire{
    if(ObjEnemy_GetInfo(objBoss, INFO_LIFE) <= 0){return;}//Default kill to prevent (0,0) spawning
    let angleT = GetAngleToPlayer(objBoss);
    CreateShotA1(ObjMove_GetX(objBoss), ObjMove_GetY(objBoss), 2, angleT, DS_BALL_S_RED, 5);
}

task TFinalize {
        while(ObjEnemy_GetInfo(objBoss,INFO_LIFE)>0){yield;}
	Obj_Delete(objBoss);
	DeleteShotAll(TYPE_ALL,TYPE_IMMEDIATE);
	SetAutoDeleteObject(true);
	CloseScript(GetOwnScriptID());
	return;
}

function GetCenterX{
     return GetStgFrameWidth/2;
}
function GetCenterY{
     return GetStgFrameHeight/2;
}

function wait(n){
     loop(n){yield;}
}</code></pre>

              <br>            </div>          </div>        </div>      </div>      <div id="ft">
        <p style="text-align: center;">Last Update to Page: Jan 9, 2014</p>        <p style="text-align: center;"><a href="#top">Top</a></p>        <p style="text-align: center;">Copyright © 2014-2015 by Andrew Fan</p>        <p style="text-align: center;"><span style="font-weight: bold;">Other            Sites/Affiliates</span></p>        <div style="text-align: center;"><a target="_blank" href="http://www.winehq.org"><img              alt="&quot;Wine HQ&quot;"              src="../images/afflogowinehq.png"></a>          <a target="_blank" href="http://www.shrinemaiden.org/forum/index.php"><img              alt="&quot;Maidens of the Kaleidoscope&quot;"              src="../images/afflogomotk.png"></a>          <a target="_blank" href="http://www.bulletforge.org"><img alt="&quot;Bulletforge&quot;"              src="../images/afflogobulletforge.png"></a>          <a target="_blank" href="http://moriyashrine.weebly.com/index.html"><img              alt="&quot;Moriya Shrine&quot;"              src="../images/afflogomoriyashrine.png"></a>        </div>
        <div style="text-align: center;"><br>
          <p><b>ADVERTISEMENTS</b></p>
          <p>Hey scripters! Want me to feature your script/project/blog/website/Youtube video down here?</p>
          <p>Read <a href="../advertisements.html">this page</a> for more information.</p><br>
        </div>      </div>    </div>
    <script language="JavaScript" type="text/javascript" src="javascript/GenericQuiz.js"></script>
    <script language="JavaScript" type="text/javascript" src="javascript/QReviewP.js"></script>
    <script language="JavaScript" type="text/javascript" src="javascript/U1L7Quiz1.js"></script>  </body></html>