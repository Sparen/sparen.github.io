<!DOCTYPE html><html lang="en-us">  <head>    <meta charset="utf-8">    <title>AFCDTech - Sparen's Danmakufu ph3 Tutorials - Lesson 28 Danmakanvas Example 1</title>    <link rel="stylesheet" type="text/css" href="../blah.css">    <meta content="Sparen's Danmakufu ph3 Tutorials Lesson 28 Danmakanvas Example 1"      name="description">
    <meta name="keywords" content="Sparen, Touhou, Danmakufu, ph3, Tutorial, Code">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-58194930-1', 'auto');
    ga('send', 'pageview');
  </script>  </head>  <body onload="setupENG('Apr 29, 2018')">    <div class="yui-t1" id="top">      <p style="text-align: center;"><a href="http://sparen.github.io"><img alt="Site Logo" src="../images/logo.png" style="width:100%;max-width:1000px"></a></p>      <br>      <div id="menubar">
        <ul>
          <li><a class="mhome" href="http://sparen.github.io" title="AFCDTech">Return to Home</a></li>
          <li><a class="mph3tutorials" href="./ph3tutorials.html" title="Sparen's Danmakufu ph3 Tutorials">ph3 Tutorial Index</a></li>
          <li><a class="mdnhwiki" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Main_Page">Danmakufu Wiki</a></li>
          <li><a class="mph3functionlist" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Functions_(ph3)">Ph3 Function List</a></li>
        </ul>
      </div>      <div id="bd">        <div id="yui-main">          <div class="yui-b">            <div class="yui-g">
	      <h2 class="ph3tutorialheader" id="cp2">Danmakanvas - Twin Rotating Familiars</h2>
	      <p>Danmakanvas is a Javascript Danmaku simulation made by Sparen. It does NOT work the same way as Danmakufu. Please be advised that the speed at which the simulation runs is therefore not equivalent to the speed that the code would run in Danmakufu.</p>
	      <pre class="prettyprint"><code>    @MainLoop {
        if(count == 0){
            ascent(i in 0..6) {CreateShikiA1B(i, 6, 1, 48); CreateShikiA1B(i, 6, -1, 96);}
        }

        count++;
        yield;
    }

    task CreateShikiA1B(ID, num, dir, rad) {
        let objcount = 0; //counter to control firing of bullets and movement
        let angleO = ID*360/num; //Initial angle (will be updated)
        //obtain object ID
        let obj = CreateShotA1(ObjMove_GetX(objEnemy), ObjMove_GetY(objEnemy), 0, ID*360/num, 29, 0); 
        //If using a bullet as a familiar, ensure it doesn't get accidentally deleted
        ObjShot_SetSpellResist(obj, true); 
        ObjShot_SetAutoDelete(obj, false);
        while(ObjEnemy_GetInfo(objEnemy, INFO_LIFE) > 0) { //linked to the parent enemy's life
            //ID*360/num sets the angle relative to the other familiars. objcount*dir handles the rotation
            angleO = ID*360/num + objcount*dir; //Update angle
            ObjMove_SetPosition(obj, ObjMove_GetX(objEnemy) + rad*cos(angleO), 
                                     ObjMove_GetY(objEnemy) + rad*sin(angleO)); 
            ObjMove_SetAngle(obj, angleO); 

            if (objcount % 12 == 0) { //control firing rate
                let currx = ObjMove_GetX(obj);
                let curry = ObjMove_GetY(obj);
                ascent(i in 0..3) {
                    CreateShotA1(currx, curry, 1.5, angleO + 180 + i * 120, 5, 0);
                }
            }

            objcount++;
            yield;
        }
        ObjShot_FadeDelete(obj);
    }</code></pre>
	      <canvas id="gamecanvas_1" width="384" height="448" style="border:1px solid #DDDDDD;">
	      </canvas>
	      <br>
	      <button type="button" onclick="startGame('gamecanvas_1')">Run Danmakanvas Simulation</button>
	      <br>            </div>          </div>        </div>      </div>      <footer id="footer">      </footer>    </div>
    <script type="text/javascript" src="javascript/ph3tutorialcommon.js"></script>
    <link href="customhighlighter/desert.css" type="text/css" rel="stylesheet" />
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=c"></script>
    <script type="text/javascript" src="javascript/Danmakanvas/GameEngine2.0.js"></script>
    <script type="text/javascript" src="javascript/Danmakanvas/PluralModule_ShikiA1.js"></script>  </body></html>