<!DOCTYPE html><html lang="en-us">  <head>    <meta charset="utf-8">    <title>AFCDTech - Sparen's Danmakufu ph3 Tutorials - Lesson 16</title>    <link rel="stylesheet" type="text/css" href="../blah.css">    <meta content="Sparen's Danmakufu ph3 Tutorials Lesson 16 - Upgrading Singles for Usage in Plurals. A guide to making (0,0) spawning errors disappear."      name="description">
    <meta name="keywords" content="Sparen, Touhou, Danmakufu, ph3, Tutorial, Script, Danmaku, Plural, Boss, Single">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-58194930-1', 'auto');
    ga('send', 'pageview');
  </script>  </head>  <body id="mhome">    <div class="yui-t1" id="top">      <p style="text-align: center;"><a href="http://sparen.github.io"><img alt="Site Logo" src="../images/logo.png" style="width:100%;max-width:1000px"></a></p>      <br>      <div id="menubar">
        <ul>
          <li><a class="mhome" href="http://sparen.github.io" title="AFCDTech">Return to Home</a></li>
          <li><a class="mph3tutorials" href="./ph3tutorials.html" title="Sparen's Danmakufu ph3 Tutorials">ph3 Tutorial Index</a></li>
          <li><a class="mdnhwiki" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Main_Page">Danmakufu Wiki</a></li>
          <li><a class="mph3functionlist" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Functions_(ph3)">Ph3 Function List</a></li>
        </ul>
      </div>      <div id="bd">        <div id="yui-main">          <div class="yui-b">
            <div class="tutnavbar">
	      <ul>
	        <li><a href="./ph3u2l15.html" title="Sparen's Danmakufu ph3 Tutorials - Using Danmakufu's Sound Functions">Unit 2 Lesson 15</a></li>
	        <li>Navigation Bar</li>
	        <li>---</li>
	      </ul>
            </div>            <div class="yui-g">	      <h1 style="color:orange">Sparen's Danmakufu ph3 Tutorials Lesson 16 - Upgrading Singles for Usage in Plurals</h1>	      <p>The video for this lesson is Python's Human Inferno, because Mokou likes to regenerate and add extra singles onto plurals with reckless abandon.</p>
	      <!--Embedded video below. Make sure to format the link correctly-->
	      <embed width="420" height="315"
		src="https://www.youtube.com/v/cPbwLy1sypg">
	      <div class="tutorialnav">
	        <h2 style="color:aqua">Table of Contents</h2>
	        <ul>
	          <li><a href="#sub1">Part 1: What will be Covered in this Lesson?</a></li>
	          <li><a href="#sub2">Part 2: Why Upgrade Single Scripts?</a></li>
	          <li><a href="#sub3">Part 3: How Do I Prevent(0,0) Spawning?</a></li>
	          <li><a href="#sub4">Part 4: How Do I Use SetAutoDeleteObject()?</a></li>
	          <li><a href="#quiz1">Quiz: ???</a></li>
	          <li><a href="#subf">Sources and External Resources</a></li>
	        </ul>
	      </div>	      <h2 style="color:yellow" id="sub1">Part 1: What will be Covered in this Lesson?</h2>
	      <p>In this lesson, I will discuss how to make single scripts plural-friendly. I will cover TFinalize in greater detail, as well as how Object Autodeletion impacts a script. Additional miscellaneous topics will also be covered. <strong>This lesson assumes that you are familiar with the contents of Lessons 3-8 and <a href="./ph3u2l12.html">Lesson 12</a>. If you are not familiar with these, please review them.</strong></p>
	      <h2 style="color:yellow" id="sub2">Part 2: Why Upgrade Single Scripts?</h2>
	      <p>So far, most of my code examples (exception being in <a href="./ph3u1l6.html">Lesson 6</a>) have been written in such a way that assumes they were mere singles, not linked into boss battles. And so, we have, for the most part, been writing code in such a way where, theoretically, bullets can spawn after the conclusion of the single. We will, in this lesson, tackle this problem.</p>
	      <p>To highlight this problem, let's consider the TFinalize from <a href="./ph3u1l7code2.html">Lesson 7</a>.</p>
	      <pre class="prettyprint linenums"><code>task TFinalize{
    while(ObjEnemy_GetInfo(objBoss,INFO_LIFE) > 0){yield;}
    if(ObjEnemyBossScene_GetInfo(objScene, INFO_PLAYER_SHOOTDOWN_COUNT)
            +ObjEnemyBossScene_GetInfo(objScene, INFO_PLAYER_SPELL_COUNT) == 0){
        AddScore(ObjEnemyBossScene_GetInfo(objScene, INFO_SPELL_SCORE));
    }
    Obj_Delete(objBoss);
    DeleteShotAll(TYPE_ALL, TYPE_IMMEDIATE);
    SetAutoDeleteObject(true);
    CloseScript(GetOwnScriptID());
    return;
}</code></pre>
	      <p>In the above, we wait for the boss's life to hit 0, and then delete the boss, delete all existing shots, and set Autodelete to true, which will tell Danmakufu to delete all objects created in this script when <code>CloseScript()</code> is run.</p>
	      <p>Now, let's say that we have a task called Spawn, which is the following:</p>
	      <pre class="prettyprint linenums"><code>task Spawn {
    while(ObjEnemy_GetInfo(objBoss, INFO_LIFE) > 0){
        ascent(i in 0..30){
            CreateShotA1(ObjMove_GetX(objBoss), ObjMove_GetY(objBoss), 2, i*23, 1, 30);
            yield;
        }
        wait(10);
    }
}</code></pre>
	      <p>Now, let's conjure a scenario. Suddenly, the boss just died. In Spawn, i is now equal to 3, and we are in an ascent loop. One frame later, the boss object no longer exists, and all objects created in the script, including all shots on the screen and all delay clouds, are deleted.</p>
	      <p>However, the task is still running. i is equal to 4. A bullet spawns as the next single in the plural starts. However, objBoss no longer exists. So the bullet spawns at (0,0), in the top left of the screen.</p>
	      <p>Admittedly, this scenario becomes more likely if you have as much as a single yield in TFinalize. But now we're going to see what exactly we can do to prevent (0,0) spawning.</p>
	      <p>UNDER CONSTRUCTION BELOW THIS LINE</p>
	      <h2 style="color:yellow" id="quiz1">Quiz: Sounds in Danmakufu</h2>
	        <!--Quiz start.-->
		<p>1) Junko wants her music to be as pure as possible. To ensure this, she wants her bgm to be recognized by Danmakufu as a BGM. How should she do this?</p>
	        <form method="POST" onSubmit="return checkAnswerP(this, 'C', 4);">
	        <input type="RADIO" value="A" name="cc">
	        A. ObjSound_SetSoundDivision(SOUND_BGM);<br>
	        <input type="RADIO" value="B" name="cc">
	        B. ObjSound_SetSoundDivision(SOUND_SE);<br>
	        <input type="RADIO" value="C" name="cc">
	        C. ObjSound_SetSoundDivision(obj, SOUND_BGM);<br>
	        <input type="RADIO" value="D" name="cc">
	        D. ObjSound_SetSoundDivision(obj, SOUND_MUSIC);<br>
	        <input type="SUBMIT" value="Submit">
	        </form>
		<br>
		<p>2) Ringo is busy eating dango when she realizes that the music playing in Danmakufu suddenly stopped playing before suddenly starting from a point in the middle of the song. What could have happened? Her code is below:</p>
	      <pre class="prettyprint"><code>    ObjSound_SetLoopTime(obj, 27, 85);//not the actual loop points of Pumpkin of September, sorry</code></pre>
	        <form method="POST" onSubmit="return checkAnswerP(this, 'C', 5);">
	        <input type="RADIO" value="A" name="cc">
	        A. Her start point in the loop (27) is incorrect and should be lower<br>
	        <input type="RADIO" value="B" name="cc">
	        B. Her end point in the loop (85) is incorrect and should be higher<br>
	        <input type="RADIO" value="C" name="cc">
	        C. The bgm is shorter than one minute and 25 seconds<br>
	        <input type="SUBMIT" value="Submit">
	        </form>
	      <h2 style="color:yellow" id="subf">Sources and External Resources</h2>
	      <p>N/A</p>
	      <br>            </div>          </div>
          <div class="tutnavbar">
	    <ul>
	      <li><a href="./ph3u2l15.html" title="Sparen's Danmakufu ph3 Tutorials - Using Danmakufu's Sound Functions">Unit 2 Lesson 15</a></li>
	      <li>Navigation Bar</li>
	      <li>---</li>
	    </ul>
	    <br>
          </div>        </div>      </div>      <footer>
        <p style="text-align: center;">Last Update to Page: Oct 19, 2015</p>        <p style="text-align: center;"><a href="#top">Top</a></p>        <p style="text-align: center;">Copyright Â© 2014-2015 by Andrew Fan</p>        <p style="text-align: center;"><span style="font-weight: bold;">Other            Sites/Affiliates</span></p>        <div style="text-align: center;"><a target="_blank" href="http://www.winehq.org"><img	      alt="&quot;Wine HQ&quot;"	      src="../images/afflogowinehq.png"></a>          <a target="_blank" href="http://www.shrinemaiden.org/forum/index.php"><img	      alt="&quot;Maidens of the Kaleidoscope&quot;"	      src="../images/afflogomotk.png"></a>          <a target="_blank" href="http://www.bulletforge.org"><img alt="&quot;Bulletforge&quot;"	      src="../images/afflogobulletforge.png"></a>          <a target="_blank" href="http://moriyashrine.weebly.com/index.html"><img	      alt="&quot;Moriya Shrine&quot;"	      src="../images/afflogomoriyashrine.png"></a>        </div>
        <div style="text-align: center;"><br>
          <p><b>ADVERTISEMENTS</b></p>
          <p>Hey scripters! Want me to feature your script/project/blog/website/Youtube video down here?</p>
          <p>Read <a href="../advertisements.html">this page</a> for more information.</p><br>
        </div>      </footer>    </div>
    <script type="text/javascript" src="javascript/GenericQuiz.js"></script>
    <script type="text/javascript" src="javascript/QReviewP.js"></script>
    <link href="customhighlighter/desert.css" type="text/css" rel="stylesheet" />
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=c"></script>  </body></html>