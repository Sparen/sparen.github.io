<!DOCTYPE html><html lang="en-us">  <head>    <meta charset="utf-8">    <title>AFCDTech - Sparen's Danmakufu ph3 Tutorials - Lesson 22</title>    <link rel="stylesheet" type="text/css" href="../blah.css">    <meta content="Sparen's Danmakufu ph3 Tutorials Lesson 22 - Implementing Scrolling 2D Backgrounds in Background Files. A guide on how to work with Background scripts."      name="description">
    <meta name="keywords" content="Sparen, Touhou, Danmakufu, ph3, Tutorial, Script, Danmaku, Plural, Boss, Single, Replay, Save">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-58194930-1', 'auto');
    ga('send', 'pageview');
  </script>  </head>  <body id="mhome">    <div class="yui-t1" id="top">      <p style="text-align: center;"><a href="http://sparen.github.io"><img alt="Site Logo" src="../images/logo.png" style="width:100%;max-width:1000px"></a></p>      <br>      <div id="menubar">
        <ul>
          <li><a class="mhome" href="http://sparen.github.io" title="AFCDTech">Return to Home</a></li>
          <li><a class="mph3tutorials" href="./ph3tutorials.html" title="Sparen's Danmakufu ph3 Tutorials">ph3 Tutorial Index</a></li>
          <li><a class="mdnhwiki" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Main_Page">Danmakufu Wiki</a></li>
          <li><a class="mph3functionlist" target="_blank" href="http://dmf.shrinemaiden.org/wiki/Functions_(ph3)">Ph3 Function List</a></li>
        </ul>
      </div>      <div id="bd">        <div id="yui-main">          <div class="yui-b">
            <div class="tutnavbar">
	      <ul>
	        <li><a href="./ph3u2l21.html" title="Sparen's Danmakufu ph3 Tutorials - Customizing Replay Save Files">Unit 2 Lesson 21</a></li>
	        <li><span>Navigation Bar</span></li>
	        <li><span>---</span></li>
	      </ul>
            </div>            <div class="yui-g">	      <h1 style="color:orange">Sparen's Danmakufu ph3 Tutorials Lesson 22 - Implementing Scrolling 2D Backgrounds in Background Files</h1>	      <p>The video for this lesson is TalosMistake's Yuyuko. Enjoy the beautiful backgrounds, which you will soon learn to make (or well, the 2D ones).</p>
	      <!--Embedded video below. Make sure to format the link correctly-->
	      <div class="ytembed_sm">
	        <iframe src="https://www.youtube.com/embed/HyBJAhkhOXQ" frameborder="0" allowfullscreen></iframe>
	      </div>
	      <div class="tutorialnav">
	        <h2 style="color:aqua">Table of Contents</h2>
	        <ul>
	          <li><a href="#sub1">Part 1: What will be Covered in this Lesson?</a></li>
	          <li><a href="#sub2">Part 2: What are Background Scripts?</a></li>
	          <li><a href="#sub3">Part 3: How are Background Scripts structured?</a></li>
	          <li><a href="#sub4">Part 4: How do I make a static 2D background?</a></li>
	          <li><a href="#sub5">Part 5: How do I make a scrolling 2D background?</a></li>
	          <li><a href="#sub6">Part 6: How do I make a rotating 2D background?</a></li>
	          <li><a href="#sub7">Part 7: How do I layer textures with varying Alpha and Blend Types?</a></li>
	          <li><a href="#quiz1">Quiz: Replay Save Scripts</a></li>
	          <li><a href="#subs">Summary</a></li>
	          <li><a href="#subf">Sources and External Resources</a></li>
	        </ul>
	      </div>	      <h2 style="color:yellow" id="sub1">Part 1: What will be Covered in this Lesson?</h2>
	      <p>In this lesson, I will discuss Background Scripts as well as how to implement various types of 2D backgrounds by transforming their component 2D sprites (simple scrolling, rotating).</p>
	      <p>This lesson requires familiarity with 2D Sprites. If you are not familiar with 2D Sprites, please refer to <a href="./ph3u2l13.html">Lesson 13</a>.</p>
	      <h2 style="color:yellow" id="sub2">Part 2: What are Background Scripts?</h2>
	      <p>We've covered a lot of different script types now. System, Replay Save, Pause, End Scene... But now we'll touch on Background scripts. Like System scripts, you link to them in the Danmakufu header, and they run for the duration of a script. You can use the same background script for stages, plurals, and singles, and they generally work well.</p>
	      <p>Note that although you can *technically* dump whatever you want in a Background script, they are generally used to run tasks for stage/nonspell backgrounds and spell backgrounds. If you have any graphical effects that do not affect gameplay, like falling cherry petals or the like, the Background script is where you put them.</p>
	      <h2 style="color:yellow" id="sub3">Part 3: How are Background Scripts structured?</h2>
	      <p>We will begin our discussion of Background scripts by dissecting the default, located in default_system/Default_Background_IceMountain.txt. Naturally, similarly to System scripts, you can name your Background script however you want, as long as you link to it properly.</p>
	      <p>Inside the default Background script, there is a field, <code>bSpell</code>, which is controlled in @MainLoop. Contents of @MainLoop are below:</p>
	      <pre class="prettyprint linenums"><code>@MainLoop
{

	let objScene = GetEnemyBossSceneObjectID();
	if(objScene != ID_INVALID && ObjEnemyBossScene_GetInfo(objScene, INFO_IS_SPELL))
	{
		bSpell = true;
	}
	else
	{
		bSpell = false;
	}
	

	yield;
}</code></pre>
	      <p>As you can see, we get the EnemyBossScene Object, and if it exists (i.e. on a boss), we check if there's a spell going on. If so, bSpell turns true, otherwise false. This is how we control the Spell Background.</p>
	      <p>In @Initialize, we will ignore all the camera and fog commands, as those are used for 3D Backgrounds. All standard Background scripts will have a task for the stage background (TNormalBackground in this case) and a task for the spell background (TSpellBackground). In this case, TNormalBackground is called three times - that is due to the way it is structured.</p>
	      <p>For the purposes of this guide, which focuses on 2D backgrounds, we will turn our focus to TSpellBackground.</p>
	      <p>At the start of the task, we define all the paths to the textures we want to use, and then create the relevant render objects (2D sprites). It is highly recommended to use render priorities of 0.21 and, if necessary, 0.22 for effects that are continuously spawned and must render over other background components. I personally advise against using more than three render priority slots. Instead, in order to layer specific textures over others, keep in mind that the order in which you create 2D sprites dictates the order in which they are created in the background.</p>
	      <p>For the default background, for example, obj2 is created after obj1. Although they have the same render priority, obj2 will render above obj1.</p>
	      <p>After creating your textures, a standard loop begins. The default background tasks use the following to fade out the stage background:</p>
	      <pre class="prettyprint linenums"><code>	let frameInvisible = 0;
...
		if(bSpell)
		{
			frameInvisible++;
			if(frameInvisible >= 60)
			{
				Obj_SetVisible(obj, false);
			}
		}
		else
		{
			frameInvisible = 0;
			Obj_SetVisible(obj, true);
		}</code></pre>
	      <p>Essentially, after 60 frames, the object in the background turns invisible. If you have multiple objects in the background to turn off, you would set all of them to invisible or visible depending on the situation.</p>
	      <p>The spell background is similar, but has slightly different structure.</p>
	      <h2 style="color:yellow" id="sub4">Part 4: How do I make a static 2D background?</h2>
	      <h2 style="color:yellow" id="sub5">Part 5: How do I make a scrolling 2D background?</h2>
	      <h2 style="color:yellow" id="sub6">Part 6: How do I make a rotating 2D background?</h2>
	      <h2 style="color:yellow" id="sub7">Part 7: How do I layer textures with varying Alpha and Blend Types?</h2>
	      <p>UNDER CONSTRUCTION BELOW THIS LINE</p>
	      <p></p>
	      <p></p>
	      <p></p>
	      <p></p>
	      <p></p>
	      <p></p>
	      <p></p>
	      <p></p>
	      <p></p>
	      <p></p>
	      <h2 style="color:yellow" id="quiz1">Quiz: Replay Save Scripts</h2>
	        <!--Quiz start.-->
		<p>1) What is the number of replays that can be stored for a given script? </p>
	        <form method="POST" onSubmit="return checkAnswerP(this, 'B', '3');">
	        <input type="RADIO" value="A" name="cc">
	        A. 10<br>
	        <input type="RADIO" value="B" name="cc">
	        B. 99<br>
	        <input type="RADIO" value="C" name="cc">
	        C. 50<br>
	        <input type="SUBMIT" value="Submit">
	        </form>
		<br>
		<p>2) How do you escape the [ character in Danmakufu? </p>
	        <form method="POST" onSubmit="return checkAnswerP(this, 'B', '2');">
	        <input type="RADIO" value="A" name="cc">
	        A. \[<br>
	        <input type="RADIO" value="B" name="cc">
	        B. [osb]<br>
	        <input type="RADIO" value="C" name="cc">
	        C. [csb]<br>
	        <input type="SUBMIT" value="Submit">
	        </form>
		<br>
	      <h2 style="color:yellow" id="subs">Summary</h2>
	        <ul>
	          <li>Replay Save Scenes run when the option to save a replay is selected from an End Scene</li>
	        </ul>
	      <h2 style="color:yellow" id="subf">Sources and External Resources</h2>
	      <p>N/A</p>
	      <br>            </div>          </div>
          <div class="tutnavbar">
	    <ul>
	      <li><a href="./ph3u2l21.html" title="Sparen's Danmakufu ph3 Tutorials - Customizing Replay Save Files">Unit 2 Lesson 21</a></li>
	      <li><span>Navigation Bar</span></li>
	      <li><span>---</span></li>
	    </ul>
	    <br>
          </div>        </div>      </div>      <footer>
        <p style="text-align: center;">Last Update to Page: Mar 03, 2017</p>        <p style="text-align: center;"><a href="#top">Top</a></p>        <p style="text-align: center;">Copyright © 2016-2017 by Andrew Fan</p>        <p style="text-align: center;"><span style="font-weight: bold;">Other            Sites/Affiliates</span></p>        <div style="text-align: center;">          <a target="_blank" href="http://www.shrinemaiden.org/forum/index.php"><img	      alt="&quot;Maidens of the Kaleidoscope&quot;"	      src="../images/afflogomotk.png"></a>          <a target="_blank" href="http://www.bulletforge.org"><img alt="&quot;Bulletforge&quot;"	      src="../images/afflogobulletforge.png"></a>        </div>      </footer>    </div>
    <script type="text/javascript" src="javascript/GenericQuiz.js"></script>
    <script type="text/javascript" src="javascript/QReviewP.js"></script>
    <link href="customhighlighter/desert.css" type="text/css" rel="stylesheet" />
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=c"></script>  </body></html>